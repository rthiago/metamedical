---
phase: 08-github-pages-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [.github/workflows/deploy.yml]
autonomous: true
requirements: [DEPLOY-03, DEPLOY-04]

must_haves:
  truths:
    - "A GitHub Actions workflow file exists that triggers deployment on push to master"
    - "Pushing a commit to master automatically publishes the site without manual intervention"
    - "The site is accessible via the GitHub Pages URL and renders correctly in a browser"
    - "All pages load with correct styles, scripts, images, and navigation links"
  artifacts:
    - path: ".github/workflows/deploy.yml"
      provides: "GitHub Actions deployment workflow for static site"
  key_links:
    - from: ".github/workflows/deploy.yml"
      to: "GitHub Pages"
      via: "actions/deploy-pages action on push to master"
      pattern: "on: push: branches: master"
    - from: "GitHub Pages URL"
      to: "repository HTML files"
      via: "pages deployment serves static files"
      pattern: "https://rthiago.github.io/metamedical/"
---

<objective>
Configure GitHub Pages deployment via GitHub Actions and verify the site is publicly accessible.

Purpose: Make the MetaMedical website publicly accessible via GitHub Pages with automated deployment on every push to master.
Output: Working GitHub Actions workflow + live site at rthiago.github.io/metamedical
</objective>

<execution_context>
@/home/thiago/.claude/get-shit-done/workflows/execute-plan.md
@/home/thiago/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Ensure GitHub Pages can deploy and create workflow</name>
  <files>.github/workflows/deploy.yml</files>
  <action>
    First, check if the repository needs to be made public for GitHub Pages:
    - Check current visibility: `gh repo view rthiago/metamedical --json visibility`
    - If private: make public with `gh repo edit rthiago/metamedical --visibility public`
      (per CONTEXT.md decision: switch to public if needed, content is meant to be public)

    Enable GitHub Pages via the API:
    - `gh api -X POST repos/rthiago/metamedical/pages -f build_type=workflow`
      (This enables Pages with GitHub Actions as the source)

    Create `.github/workflows/deploy.yml` with the standard static site deployment workflow:

    ```yaml
    name: Deploy to GitHub Pages

    on:
      push:
        branches: [master]
      workflow_dispatch:

    permissions:
      contents: read
      pages: write
      id-token: write

    concurrency:
      group: pages
      cancel-in-progress: false

    jobs:
      deploy:
        environment:
          name: github-pages
          url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        steps:
          - name: Checkout
            uses: actions/checkout@v4
          - name: Setup Pages
            uses: actions/configure-pages@v5
          - name: Upload artifact
            uses: actions/upload-pages-artifact@v3
            with:
              path: .
          - name: Deploy to GitHub Pages
            id: deployment
            uses: actions/deploy-pages@v4
    ```

    Key decisions honored:
    - Triggers on `master` (not `main`) per Phase 7 user decision
    - Deploys entire root directory (plain HTML/CSS/JS, no build step)
    - Uses official actions/deploy-pages pattern per CONTEXT.md

    Stage, commit, and push to trigger the workflow:
    - `git add .github/workflows/deploy.yml`
    - Commit with appropriate message
    - `git push origin master`
  </action>
  <verify>
    `cat .github/workflows/deploy.yml` shows the workflow file exists with correct trigger on master.
    `git log --oneline origin/master | head -1` shows the workflow commit was pushed.
  </verify>
  <done>GitHub Actions workflow file exists at .github/workflows/deploy.yml, committed and pushed to trigger first deployment.</done>
</task>

<task type="auto">
  <name>Task 2: Verify deployment and site accessibility</name>
  <files></files>
  <action>
    Wait for the GitHub Actions workflow to complete:
    - `gh run list --workflow=deploy.yml --limit 1` to check the run status
    - If status is "in_progress", wait and re-check (poll every 15 seconds for up to 3 minutes)
    - If status is "completed" with conclusion "success", proceed to verify

    If deployment fails:
    - Check run logs: `gh run view --log-failed`
    - Common issues:
      - Pages not enabled: `gh api -X POST repos/rthiago/metamedical/pages -f build_type=workflow`
      - Permission issues: check workflow permissions in YAML

    Verify the site is accessible:
    - Get the Pages URL: `gh api repos/rthiago/metamedical/pages --jq '.html_url'`
    - Expected URL: https://rthiago.github.io/metamedical/
    - Use curl to check HTTP status: `curl -sL -o /dev/null -w "%{http_code}" https://rthiago.github.io/metamedical/`
    - Expected: 200

    Verify site content renders correctly:
    - `curl -sL https://rthiago.github.io/metamedical/ | grep -c "MetaMedical"` should return matches
    - `curl -sL https://rthiago.github.io/metamedical/css/style.css -o /dev/null -w "%{http_code}"` should return 200
    - `curl -sL https://rthiago.github.io/metamedical/js/animations.js -o /dev/null -w "%{http_code}"` should return 200
    - `curl -sL https://rthiago.github.io/metamedical/empresa.html -o /dev/null -w "%{http_code}"` should return 200
    - `curl -sL https://rthiago.github.io/metamedical/produtos.html -o /dev/null -w "%{http_code}"` should return 200

    All internal paths are already relative (e.g., `href="css/style.css"`, `href="empresa.html"`), so they should work correctly under the /metamedical/ subdirectory without modification.
  </action>
  <verify>
    GitHub Actions workflow run completed successfully (`gh run list --workflow=deploy.yml` shows success).
    `curl -sL -o /dev/null -w "%{http_code}" https://rthiago.github.io/metamedical/` returns 200.
    `curl -sL https://rthiago.github.io/metamedical/ | grep "MetaMedical"` finds content.
    CSS and JS files return HTTP 200.
    All 5 HTML pages return HTTP 200.
  </verify>
  <done>Site is live at https://rthiago.github.io/metamedical/, all pages render correctly, CSS/JS/images load, GitHub Actions deployment successful.</done>
</task>

</tasks>

<verification>
1. `.github/workflows/deploy.yml` exists with correct trigger on master branch
2. `gh run list --workflow=deploy.yml --limit 1` shows a successful run
3. `curl -sL -o /dev/null -w "%{http_code}" https://rthiago.github.io/metamedical/` returns 200
4. All 5 pages accessible: index.html, empresa.html, produtos.html, localizacao.html, contato.html
5. CSS, JS, and images load correctly (HTTP 200 for key assets)
</verification>

<success_criteria>
- GitHub Actions workflow file at .github/workflows/deploy.yml triggers on push to master
- Workflow completed successfully at least once
- Site accessible at https://rthiago.github.io/metamedical/
- All pages render with correct styles, scripts, and navigation
- External resources (Google Fonts, Google Maps, CDN images) still load
</success_criteria>

<output>
After completion, create `.planning/phases/08-github-pages-deployment/08-01-SUMMARY.md`
</output>
